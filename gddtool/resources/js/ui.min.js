!function(a){var b=function(a){return new Date(a.toISOString().split("T")[0]+"T12:00:00-04:30")},c=function(a){return a instanceof Date?b(a):Array.isArray(a)?b(new Date(a[0],a[1]-1,a[2])):new Date(a+"T12:00:00-04:30")},d=function(b){a.each(b,function(a,b){console.log("    ATTRIBUTE "+a+" = "+b)})},e={active:!0,callback:null,chart_types:{trend:"Recent Trend",outlook:"Season Outlook"},default_chart:"trend",chartType:function(b){return this.active?a("#gddtool-toggle-button").val():"season"},execCallback:function(a){this.callback&&this.callback("chartChangeRequest",a)},hideChartSelector:function(){a("#gddtool-toggle-display").hide()},hideChartMsg:function(b){a("#gddtool-"+b+"-text").hide()},init:function(){var c,b=this.default_chart;c="trend"==b?"outlook":"trend",a("#gddtool-toggle-button").addClass(b),a("#gddtool-toggle-button").button({label:this.chart_types[c]}),a("#gddtool-toggle-button").click(function(){e.toggleChart()})},setChartType:function(b){"trend"==b?(a("#gddtool-toggle-button").hasClass("outlook")&&a("#gddtool-toggle-button").removeClass("outlook"),a("#gddtool-toggle-button").addClass("trend"),a("#gddtool-toggle-button").button({label:this.chart_types.outlook}),this.execCallback("trend")):"outlook"==b&&(a("#gddtool-toggle-button").hasClass("trend")&&a("#gddtool-toggle-button").removeClass("trend"),a("#gddtool-toggle-button").addClass("outlook"),a("#gddtool-toggle-button").button({label:this.chart_types.trend}),this.execCallback("outlook"))},showChartSelector:function(){a("#gddtool-season-over-text").hide(),a("#gddtool-plant-late-text").hide(),a("#gddtool-toggle-display").show()},showChartMsg:function(b){a("#gddtool-"+b+"-text").show()},toggleChart:function(){a("#gddtool-toggle-button").hasClass("trend")?(a("#gddtool-toggle-button").removeClass("trend"),a("#gddtool-toggle-button").addClass("outlook"),a("#gddtool-toggle-button").button({label:this.chart_types.trend}),this.execCallback("outlook")):a("#gddtool-toggle-button").hasClass("outlook")&&(a("#gddtool-toggle-button").removeClass("outlook"),a("#gddtool-toggle-button").addClass("trend"),a("#gddtool-toggle-button").button({label:this.chart_types.outlook}),this.execCallback("trend"))}},f={anchor:"#gddtool-datepicker",button_url:null,callbacks:{},datepicker:"#ui-datepicker-div",date_format:"yy-mm-dd",initialized:!1,max_date:null,min_date:null,show_months:!1,show_years:!0,start_date:null,year_range:null,execCallback:function(a,b){var c=this.callbacks[a];if("undefined"!=typeof c){c(a,b)}},date:function(){return a(this.anchor).datepicker("getDate")},init:function(b){var d={autoclose:!0,beforeShow:function(){a(f.datepicker).hide(),a("#gddtool-date-selector").append(a(f.datepicker))},buttonImage:this.button_url,buttonImageOnly:!0,buttonText:this.button_label,changeMonth:this.show_months,changeYear:this.show_years,dateFormat:this.date_format,gotoCurrent:!0,onChangeMonthYear:function(a,b,c){console.log("datepicker.onChangeMonthYear : "+f.start_date.getFullYear()+" : "+a)},onSelect:function(b,d){f.start_date=c(b),f.execCallback("plantDateChanged",b),a("#ui-datepicker-div").hide()},showAnim:"clip",showButtonPanel:!1,showOn:"button",showOtherMonths:!0};null!=this.max_date&&null!=this.min_date&&(d.maxDate=this.max_date,d.minDate=this.min_date),null!=this.year_range&&(d.changeYear=!0,d.yearRange=this.year_range),a(this.anchor).datepicker(d),this.initialized=!0,a(this.datepicker).hide(),a("#gddtool-datepicker").change(function(){f.execCallback("plantDateChanged",this.value)}),a("#ui-datepicker-div .ui-datepicker-header .ui-datepicker-title .ui-datepicker-year").change(function(){console.log("#ui-datepicker-year.change :: "+this.value)}),"undefined"!=typeof b?this.setStartDate(b):null!=this.start_date?this.setStartDate(this.start_date):this.setStartDate((new Date).toISOString().split("T")[0])},setCallback:function(a,b){this.callbacks[a]=b},setDateRange:function(a,b){this.min_date=c(a),this.max_date=c(b)},setStartDate:function(b){this.start_date=c(b),this.current_year=this.start_date.getFullYear(),this.initialized&&a(this.anchor).datepicker("setDate",this.start_date)},setYearRange:function(a,b){this.min_year=a,this.max_year=b,this.year_range=a.toString()+":"+b.toString()}},g=function(){var a=document.querySelector('input[name="gdd-select-threshold"]:checked').value;h.setThreshold(a)},h={callback:null,current:null,default:"50",execCallback:function(a){this.callback&&this.callback("gddThresholdChanged",a)},init:function(){a.each(document.getElementsByName("gdd-select-threshold"),function(){this.addEventListener("click",g)});var b='input[name="gdd-select-threshold"] [value="'+this.default+'"]';this.current=this.default,a(b).prop("checked",!0)},setThreshold:function(b){if(b!=this.current){var c='input[name="gdd-select-threshold"] [value="'+this.current+'"]';a(c).prop("checked",!1),c='input[name="gdd-select-threshold"] [value="'+b+'"]',a(c).prop("checked",!0),this.current=b,this.execCallback(b)}},threshold:function(){return a('input[name="gdd-select-threshold"]:checked').val()}},i={callbacks:{},container:null,current:null,default:{address:"Cornell University, Ithaca, NY",lat:42.45,lng:-76.48,key:"default"},dialog:null,execCallback:function(a,b){var c=this.callbacks[a];if("undefined"!=typeof c){var e=b;return"undefined"==typeof b&&(e=this.location()),d(e),c(a,e),!0}return!1},init:function(){this.current?this.setLocation(this.current):this.setLocation(this.default),a("#gddtool-change-location").button({label:"Change Location"}),a("#gddtool-change-location").click(function(){i.execCallback("locationChangeRequest")})},location:function(){return a.extend({},this.current)},locationsAreDifferent:function(a,b){return a.address!=b.address||a.lat!=b.lat||a.lng!=b.lng},setCallback:function(a,b){this.callbacks[a]=b},setLocation:function(b){d(b);var c='<span class="gddtool-location-address">{{ address }}</span>';if(null==this.current||this.locationsAreDifferent(b,this.current)){var f=null,g=b.address.indexOf(", USA");f=g>0?b.address.replace(", USA",""):b.address;var h=f.split(", ");f=h.length>1?c.replace("{{ address }}",h[0])+"</br>"+c.replace("{{ address }}",h.slice(1).join(", ")):c.replace("{{ address }}",f),a("#gddtool-current-address").empty().append(f),null!=this.current&&this.execCallback("locationChanged",a.extend({},b)),this.current=a.extend({},b)}else b.key!=this.current.key&&(this.current=a.extend({},b))}},j={dom:['<div id="gddtool-location">','<span class="csftool-em">Current Location :</span>','<div id="gddtool-current-address"><span class="gddtool-location-address"> </span></div>','<button id="gddtool-change-location"></button>',"</div>",'<div id="gddtool-plant-date">','<span class="csftool-em">Planting Date:</span>','<div id="gddtool-date-selector">','<input type="text" id="gddtool-datepicker">',"</div>","</div>",'<div id="gddtool-thresholds">','<form><span class="csftool-em">GDD Threshold</span><br/>','<input type="radio" name="gdd-select-threshold" class="gdd50" value="50" checked="checked"></input>&nbsp;Base 50<br/>','<input type="radio" name="gdd-select-threshold" class="gdd8650" value="8650"></input>&nbsp;Base 8650',"</form>","</div>",'<div id="gddtool-chart-button">','<p id="gddtool-season-over-text">Growing season is over.</p>','<p id="gddtool-plant-late-text">Plant date is after latest avaliable forecast.</p>','<div id="gddtool-toggle-display">','<button id="gddtool-toggle-button"></button>',"</div>","</div>","</div>"].join(""),initial_date:void 0,init:function(a){a.innerHTML=this.dom,i.init(),f.init(this.initial_date),h.init(),e.init()},setCallback:function(a,b){switch(a){case"chartChangeRequest":e.callback=b;break;case"gddThresholdChanged":h.callback=b;break;case"locationChanged":i.setCallback("locationChanged",b);break;case"locationChangeRequest":i.setCallback("locationChangeRequest",b);break;case"plantDateChanged":f.setCallback("plantDateChanged",b);break;case"yearChanged":f.setCallback("yearChanged",b)}}},k=function(){if(1==arguments.length){var b=arguments[0];switch(b){case"chart":return e.chartType();case"date_range":return{min_date:f.min_date,max_date:f.max_date};case"gdd_threshold":return h.threshold();case"hide_chart_selector":return e.hideChartSelector();case"location":return i.location();case"plant_date":return f.date();case"show_chart_selector":return e.showChartSelector()}}else if(2==arguments.length){var d=arguments[0],g=arguments[1];switch(d){case"bind":a.each(g,function(a){var b=g[a];for(var c in b)j.setCallback(c,b[c])});break;case"date_button_url":f.button_url=g;break;case"chart":e.setChartType(g);break;case"chart_types":e.setChartTypes(g);break;case"date_range":f.setDateRange(g[0],g[1]);break;case"hide_chart_msg":e.hideChartMsg(g);break;case"initial_date":j.initial_date=c(g);break;case"location":i.setLocation(g);break;case"plant_date":f.setStartDate(g);break;case"show_chart_msg":e.showChartMsg(g);break;case"year_range":f.setYearRange(g[0],g[1])}}else if(3==arguments.length){var d=arguments[0],g=arguments[1],k=arguments[2];switch(d){case"bind":j.setCallback(g,k);break;case"date_range":f.setDateRange([g,k]);break;case"year_range":f.setYearRange(g,k);break;case"default":"chart"==g?e.default_chart=k:"location"==g&&(i.default=a.extend({},k))}}};a.fn.GddToolUserInterface=function(b){var c=this.get(0);return b&&a.each(b,function(a,b){k(a,b)}),j.init(c),k}}(jQuery),function(a){var b=function(){var b='<span style="font-size:12px;font-weight:bold;text-align:center">'+Highcharts.dateFormat("%b %d, %Y",this.x)+"</span>";return a.each(this.points,function(){b+="line"==this.series.type?"<br/>"+this.y+' : <span style="color:'+this.color+'">'+this.series.name+"</span>":"<br/>"+this.point.low.toFixed(0)+"-"+this.point.high.toFixed(0)+' : <span style="color:'+this.color+'">'+this.series.name+"</span>"}),b},c={callback:null,chart:null,chart_anchor:"#gddtool-display-chart",chart_labels:{},chart_type:null,chart_config:{chart:{type:"line"},plotOptions:{series:{states:{hover:{enabled:!0,halo:!1}}}},credits:{text:"Powered by NRCC",href:"http://www.nrcc.cornell.edu/",color:"#000000"},title:{text:"Cumulative Growing Degree Days"},subtitle:{text:"location address",style:{"font-size":"14px",color:"#000000"}},xAxis:{type:"datetime",crosshair:{width:1,color:"#ff0000",snap:!0},labels:{style:{color:"#000000"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%d %b",week:"%d %b",month:"%b<br/>%Y",year:"%Y"}},yAxis:{title:{text:"Cumulative GDD",style:{"font-size":"14px",color:"#000000"}},min:0,labels:{style:{color:"#000000"}}},tooltip:{useHtml:!0,shared:!0,borderColor:"#000000",borderWidth:2,borderRadius:8,shadow:!1,backgroundColor:"#ffffff",crosshairs:{width:2,color:"#000000"},xDateFormat:"%b %d, %Y",positioner:function(){return{x:80,y:60}},formatter:b},legend:{floating:!0,backgroundColor:"#ffffff",borderRadius:5,borderWidth:1,align:"left",verticalAlign:"top",x:70,y:50,width:135,zindex:20},series:[]},components:{forecast:{name:"6 Day Forecast",type:"line",zIndex:15,lineWidth:2,color:"#ff0000",marker:{enabled:!0,fillColor:"#ff0000",lineWidth:2,lineColor:"#ff0000",radius:2,symbol:"circle"}},normal:{name:'30 Year "Normal"',type:"line",zIndex:12,lineWidth:2,color:"#B041FF",marker:{enabled:!1,states:{hover:{enabled:!1}}}},por:{name:"Period of Record",type:"arearange",zIndex:10,lineWidth:2,color:"#444444",fillColor:"#eeeeee",fillOpacity:.1,marker:{enabled:!1,states:{hover:{enabled:!1}}}},recent:{name:"15 Year Average",type:"line",zIndex:13,lineWidth:2,color:"#0000ff",marker:{enabled:!1,states:{hover:{enabled:!1}}}},season:{name:"Year to Date",type:"line",zIndex:14,lineWidth:2,color:"#00dd00",marker:{enabled:!0,fillColor:"#00dd00",lineWidth:2,lineColor:"#00dd00",radius:2,symbol:"circle"}}},change_pending:!0,default_chart:null,display_anchor:null,dom:'<div id="gddtool-display-chart"></div>',drawn:[],gdd_threshold:null,initialized:!1,location:null,pending_series:[],series_order:["season","forecast","recent","normal","por"],plant_date:null,tool:null,year:null,addSeries:function(b,c){var d=a.extend(!0,{id:b,data:c},this.components[b]);if(c.length>0)if(this.validChart(),this.chart){var e=this.drawn.indexOf(b)>-1;e&&this.remove(b),this.chart.addSeries(d,!0),this.drawn.indexOf(b)<0&&this.drawn.push(b),this.pending_series.length>0&&this.drawPending()}else this.pending_series.push([b,d]);else this.drawn.push(b);this.draw_pending=!1,this.complete()},addSeriesType:function(a){var b=null;switch(a){case"forecast":b=this.tool.forecast();break;case"normal":b=this.tool.climateNorms(this.chart_type);break;case"season":b=this.tool.observations(this.chart_type);break;case"por":b=this.tool.periodOfRecord(this.chart_type);break;case"recent":b=this.tool.recentHistory(this.chart_type)}null!==b&&this.addSeries(a,b)},allDrawn:function(){return this.drawn.length==this.series_order.length},bind:function(a,b){this.callback=b},changeGddThreshold:function(a){a!=this.gdd_threshold&&(this.gdd_threshold=a.toString(),this.changePending(!0))},changeLocation:function(a){var b;b="string"==typeof a?a.toString():a.address.toString(),b!=this.location&&(this.location=b,this.changePending(!0))},changePending:function(a){1==a?(this.change_pending=!0,this.drawn=[]):this.change_pending=!1},clear:function(){for(;this.chart.series.length>0;)this.chart.series[0].remove(!1);this.drawn=[]},complete:function(a){this.allDrawn()&&this.execCallback(a)},draw:function(){this.drawn=[],this.addSeries("season",this.tool.observations(this.chart_type)),this.addSeries("forecast",this.tool.forecast()),this.addSeries("recent",this.tool.recentHistory(this.chart_type)),this.addSeries("normal",this.tool.climateNorms(this.chart_type)),this.addSeries("por",this.tool.periodOfRecord(this.chart_type))},drawChartLabel:function(){var a=this.tool.dates.season+" "+this.chart_labels[this.chart_type];this.chart.renderer.text(a,325,85).css({color:"#000000",fontSize:"16px"}).add()},drawErrorLabel:function(a){var b=a+" Season is not avalaible";this.chart.renderer.text(b,200,85).css({color:"#ff0000",fontSize:"20px"}).add()},drawPending:function(){if(this.pending_series.length>0){this.validChart();for(var a;this.pending_series.length>0;)a=this.pending_series.pop(),this.chart.addSeries(a[1],!0),this.drawn.indexOf(a[0])<0&&this.drawn.push(a[0]);this.complete()}},execCallback:function(a){"undefined"!=typeof this.callback&&null!=this.callback&&(this.callback("drawing_complete"),"undefined"!=typeof a&&a===!0&&(this.drawn=[]))},highchartsIsAvailable:function(){return"undefined"!=typeof Highcharts},init:function(b){this.display_anchor=b.id,a(b).append(this.dom),Highcharts.setOptions({global:{useUTC:!1}}),this.initialized=!0,null==this.chart_type&&(this.chart_type=this.default_chart)},newChart:function(){null!=this.chart&&(this.chart.destroy(),this.chart=null);var b=a.extend(!0,{},this.chart_config);b.series=[],b.title.text=this.title(),b.subtitle.text=this.subtitle(),a("#gddtool-display-chart").highcharts("Chart",b),this.chart=a("#gddtool-display-chart").highcharts(),0==arguments.length?this.drawChartLabel():this.drawErrorLabel(arguments[0]),this.changePending(!1),this.drawn=[],this.pending_series=[]},redraw:function(){this.newChart(),this.draw()},refresh:function(){this.clear(),this.draw()},remove:function(a){if(null!=this.chart)if("undefined"!=typeof a){var b,c=this.components[a].name,d=this.chart.series.length;for(b=0;b<d;b++)if(this.chart.series[b].name==c){this.chart.series[b].remove();break}}else this.chart.destroy(),this.chart=null,this.change_pending=!0},setChartType:function(a){this.chart_type=a,this.changePending(!0)},subtitle:function(){return"@ "+this.location},title:function(){return"Cumulative Base "+this.gdd_threshold+" Growing Degree Days"},trendEndIndex:function(){return end_index=this.tool.dates.indexOf("fcast_end"),end_index>=0?end_index:this.tool.dates.indexOf("last_obs")},validChart:function(){(this.change_pending||"undefined"==typeof this.chart||null===this.chart)&&this.newChart()}},d=function(){if(1==arguments.length)switch(arguments[0]){case"all_series_drawn":return c.allDrawn();case"change_pending":return c.change_pending;case"chart":case"chart_type":return c.chart_type;case"chart_anchor":return c.chart_anchor;case"display_anchor":return c.display_anchor;case"draw":c.draw();break;case"drawn":return c.drawn;case"drawPending":c.drawPending();break;case"gdd_threshold":return c.gdd_threshold;case"location":return c.location;case"pending":return c.pending.length;case"plant_date":return c.plant_date;case"redraw":c.redraw();break;case"refresh":c.refresh();break;case"season":return c.season}else if(2==arguments.length){var b=arguments[0],e=arguments[1];switch(b){case"addSeries":c.addSeriesType(e);break;case"change_pending":c.changePending(e);break;case"chart":case"chart_type":c.setChartType(e);break;case"default":c.default_chart=e;break;case"gdd_threshold":c.changeGddThreshold(e);break;case"height":c.chart_config.chart.height=e;break;case"labels":c.chart_labels=a.extend({},e);break;case"location":c.changeLocation(e);break;case"new_data":c.newDataAvailable(e);break;case"options":a.each(e,function(a,b){d(a,b)});break;case"plant_date":c.plant_date=e;break;case"season":c.season=e;break;case"show_error":c.newChart(e);break;case"tool":c.tool=e;break;case"width":c.chart_config.chart.width=e}}else if(3==arguments.length){var b=arguments[0],e=arguments[1],f=arguments[2];switch(b){case"bind":c.bind(e,f);break;case"label":c.chart_labels[e]=f;break;case"option":this(e,f)}}};a.fn.GddToolChart=function(a){var b=this.get(0);return"undefined"!=typeof a&&d("options",a),c.init(b),d}}(jQuery);